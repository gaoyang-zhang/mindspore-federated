role: leaderhead
model: # define the net of vFL party
  train_net:
    name: leaderhead_loss_net
    inputs:
      - name: hidden_states
        destination: remote
      - name: input_ids
        destination: remote
      - name: word_table
        destination: remote
      - name: position_id
        destination: remote
      - name: attention_mask
        destination: remote
    outputs:
      - name: output
        destination: local
  eval_net:
    name: leader_eval_net
    inputs:
      - name: encoder_output
        source: remote
      - name: top_query_hidden_states
        source: remote
      - name: encoder_masks
        destination: remote
      - name: input_ids
        source: local
      - name: word_table
        source: remote
    outputs:
      - name: log_probs
        destination: local
    gt: label
opts: # define ms optimizer
  - type: CustomizedAdam
    grads:
      - inputs:
          - name: hidden_states
          - name: input_ids
          - name: word_table
          - name: position_id
          - name: attention_mask
        output:
          name: output
          index: 0
        get_all: False
        get_by_list: True
        sens_param: True
        sens: 1024.0
    params:
      - name: top_query_layer
    hyper_parameters:
      learning_rate: 5.e-6
      eps: 1.e-8
      loss_scale: 1024.0
grad_scalers: # define the grad scale calculator
  - inputs:
      - name: hidden_states
      - name: input_ids
      - name: word_table
      - name: position_id
      - name: attention_mask
    output:
      name: output
    sens: 1024.0
dataset:
  name: wiki
  features:
    - input_ids
    - position_id
    - attention_mask
hyper_parameters:
  epochs: 20
  batch_size: 2
  workers: 1
  is_eval: False
network:
  master_ip: 127.0.0.1:8082
  peer_ip: 127.0.0.1:8081
